<!DOCTYPE html>
<html>
<head>
  <title>Rubel Boss Post Panel</title>
</head>
<body>
  <h2>নতুন পোস্ট যোগ করো</h2>
  <input type="text" id="postInput" placeholder="রুবেল বস কি বলবে?" />
  <button onclick="addPost()">Add Post</button>
  <div id="status"></div>

  <h3>রুবেল বসের পোস্টসমূহ:</h3>
  <ul id="postList"></ul>

  <script>
    const token = "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"; // কইলাম না রে! বাইরের কাউরে দিবি না!
    const owner = "dkshuvo"; // GitHub ইউজারনেম
    const repo = "Practice"; // GitHub রিপো নাম
    const path = "data.json"; // ফাইল পাথ

    async function fetchPosts() {
      try {
        const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
          headers: {
            Authorization: `token ${token}`,
            Accept: 'application/vnd.github.v3+json'
          }
        });
        const data = await response.json();
        const content = JSON.parse(atob(data.content));
        displayPosts(content);
        return { content, sha: data.sha };
      } catch (err) {
        document.getElementById('status').innerText = 'পোস্ট লোড করতে সমস্যা হইছে!';
        return { content: [], sha: null };
      }
    }

    function displayPosts(posts) {
      const postList = document.getElementById('postList');
      postList.innerHTML = '';
      posts.forEach(post => {
        const li = document.createElement('li');
        li.innerText = post;
        postList.appendChild(li);
      });
    }

    async function addPost() {
      const input = document.getElementById('postInput');
      const newPost = input.value.trim();
      if (!newPost) return alert('কিচ্ছু লিখলি না তো!');
      document.getElementById('status').innerText = 'রুবেল বসের পোস্ট আপডেট হচ্ছে...';

      const { content, sha } = await fetchPosts();
      if (!sha) return;

      content.unshift(newPost);

      const updateResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
        method: 'PUT',
        headers: {
          Authorization: `token ${token}`,
          Accept: 'application/vnd.github.v3+json'
        },
        body: JSON.stringify({
          message: "Update by Rubel Boss",
          content: btoa(JSON.stringify(content, null, 2)),
          sha: sha
        })
      });

      if (updateResponse.ok) {
        document.getElementById('status').innerText = 'রুবেল বসের পোস্ট সেভ হয়ে গেছে!';
        input.value = '';
        displayPosts(content);
      } else {
        document.getElementById('status').innerText = 'কিছু একটা গন্ডগোল হয়েছে!';
      }
    }

    // প্রথমেই সব পোস্ট লোড করো
    fetchPosts();
  </script>
</body>
</html>
